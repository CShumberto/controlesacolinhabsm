<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRUD com DataTables, Paginação e Filtro de Pesquisa</title>

    <!-- Inclua o jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Inclua o DataTables -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.css">
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.js"></script>

    <!-- Configuração do Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.3.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.3.2/firebase-firestore.js"></script>

    <script>
        // Configuração do Firebase
        const firebaseConfig = {
         apiKey: "AIzaSyC28CYNjHhUi8rOwrASXdRJ1cm2PV6fEW4",
    authDomain: "controlemensal-sacolinhas.firebaseapp.com",
    databaseURL: "https://controlemensal-sacolinhas-default-rtdb.firebaseio.com",
    projectId: "controlemensal-sacolinhas",
    storageBucket: "controlemensal-sacolinhas.appspot.com",
    messagingSenderId: "925424065013",
    appId: "1:925424065013:web:cf961586c6300ceb1468bc"
        };

        // Inicialize o Firebase
        firebase.initializeApp(firebaseConfig);

        // Obtenha uma referência para a coleção onde deseja armazenar os dados
        const db = firebase.firestore();
        const dadosCollection = db.collection('controlemensal-sacolinhas');
    </script>

    <!-- Estilos CSS para a tabela -->
    <style>
        #pesquisa {
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <label for="pesquisa">Pesquisar:</label>
    <input type="search" id="pesquisa" class="form-control" placeholder="Digite uma palavra-chave">

    <table id="tabela-dados" class="display" style="width:100%">
        <thead>
            <tr>
                <th>Dia</th>
                <th>Número da Loja</th>
                <th>Nome do Operador</th>
                <th>TOTAL Easy Open Bag G</th>
                <th>TOTAL Planeta Agradece P</th>
                <th>Total de Sacolinhas (UN)</th>
                <th>Valor total sacolinha G (R$)</th>
                <th>Valor total sacolinha P (R$)</th>
                <th>Valor Total sacolinha (R$)</th>
                <th>Venda total mensal (R$)</th>
                <th>% Faturamento</th>
                <th>Observação</th>
                <th>Editar</th>
                <th>Deletar</th>
            </tr>
        </thead>
        <tbody>
            <!-- Os dados serão preenchidos aqui dinamicamente -->
        </tbody>
    </table>

    <script>
        $(document).ready(function () {
            const tabela = $('#tabela-dados').DataTable({
                paging: true,
                pageLength: 10,
                searching: true,
                // Outras configurações personalizadas aqui
            });

            // Configurar o evento de pesquisa
            $('#pesquisa').on('keyup', function () {
                tabela.search($(this).val()).draw();
            });

            // Função para adicionar botões de edição e exclusão aos dados da tabela
            function adicionarBotoesEditarDeletar() {
                return `
                    <button class="editar">Editar</button>
                    <button class="deletar">Deletar</button>
                `;
            }

            // Buscar os dados do Firestore e preencher a tabela
            dadosCollection.get().then((querySnapshot) => {
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    // Certifique-se de que os nomes das colunas correspondam aos dados
                    tabela.row.add([
                        data.dia,
                        data.numerodaloja,
                        data.nomedooperador,
                        data.totaleasyopenbagg,
                        data.totalplanetaagradecesp,
                        data.totaldesacolinhasun,
                        data.valortotalsacolinhasr,
                        data.valortotalsacolinhapr,
                        data.valortotalsacolinhart,
                        data.vendatotalmensalr,
                        data.percentualfaturamento,
                        data.observacao,
                        adicionarBotoesEditarDeletar() // Adicione os botões de edição e exclusão
                    ]).draw();
                });

                // Configurar eventos de clique para os botões de edição e exclusão
                $('#tabela-dados tbody').on('click', 'button.editar', function () {
                    const data = tabela.row($(this).parents('tr')).data();
                    // Implemente sua lógica de edição aqui com os dados da linha
                    console.log('Editar:', data);
                });

                $('#tabela-dados tbody').on('click', 'button.deletar', function () {
                    const data = tabela.row($(this).parents('tr')).data();
                    // Implemente sua lógica de exclusão aqui com os dados da linha
                    console.log('Deletar:', data);
                });
            }).catch((error) => {
                console.error('Erro ao obter documentos:', error);
            });
        });
    </script>
</body>
</html>
