<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>CRUD Firebase Firestore com DataTables</title>

    <!-- CSS do DataTables -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.css">

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- JavaScript do DataTables -->
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.js"></script>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.6.6/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.6/firebase-firestore-compat.js"></script>

    <!-- Bootstrap CSS e JS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <!-- Ícones FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.0/css/all.min.css">

    <!-- Datepicker -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/locales/bootstrap-datepicker.pt-BR.min.js"></script>

    <style>
        /* Estilos personalizados para a tabela */
        .dataTables_wrapper {
            padding: 0; /* Remova o preenchimento */
            margin: 0; /* Remova as margens */
        }

        /* Estilo para ocultar o ícone de carregamento por padrão */
        #loading-icon {
            display: none;
        }
    </style>
</head>
<body>
    <h1 class="mt-4">CRUD Firebase Firestore com DataTables</h1>

    <!-- Botão para adicionar um novo registro -->
    <button id="adicionarRegistro" class="btn btn-primary mt-3"><i class="fas fa-plus"></i> Adicionar Registro</button>

    <!-- Tabela de dados -->
    <table id="tabela-dados" class="display mt-3">
        <thead>
            <tr>
                <th>Dia</th>
                <th>Número da Loja</th>
                <th>Nome do Operador</th>
                <th>TOTAL Easy Open Bag G</th>
                <th>TOTAL Planeta Agradece P</th>
                <th>Venda total mensal (R$)</th>
                <th>Total de Sacolinhas (UN)</th>
                <th>Valor total sacolinha G (R$)</th>
                <th>Valor total sacolinha P (R$)</th>
                <th>Valor Total sacolinha (R$)</th>
                <th>% Faturamento</th>
                <th>Observação</th>
                <th>Editar</th>
                <th>Excluir</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <!-- Modal para adicionar/editar registro -->
    <div class="modal fade" id="modalRegistro" tabindex="-1" role="dialog" aria-labelledby="modalRegistroLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalRegistroLabel">Adicionar Registro</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <!-- Formulário de adição/editação de registro -->
                    <form id="formularioRegistro">
                        <input type="hidden" id="registroId">
                        <div class="form-group">
                            <label for="dia">Dia:</label>
                            <input type="date" class="form-control" id="dia" required>
                        </div>
                        <div class="form-group">
                            <label for="numeroLoja">Número da Loja:</label>
                            <input type="text" class="form-control" id="numeroLoja">
                        </div>
                        <!-- Outros campos do formulário aqui -->
                        <!-- ... -->

                        <div class="form-group">
                            <label for="observacao">Observação:</label>
                            <textarea class="form-control" id="observacao" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Fechar</button>
                    <!-- Botão de salvar com ícone de carregamento -->
                    <button type="button" class="btn btn-primary" id="salvarRegistro">
                        <i id="loading-icon" class="fas fa-spinner fa-spin"></i> Salvar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuração do Firebase
        const firebaseConfig = {
             apiKey: "AIzaSyC28CYNjHhUi8rOwrASXdRJ1cm2PV6fEW4",
    authDomain: "controlemensal-sacolinhas.firebaseapp.com",
    databaseURL: "https://controlemensal-sacolinhas-default-rtdb.firebaseio.com",
    projectId: "controlemensal-sacolinhas",
    storageBucket: "controlemensal-sacolinhas.appspot.com",
    messagingSenderId: "925424065013",
    appId: "1:925424065013:web:cf961586c6300ceb1468bc"
        };

        // Inicialize o Firebase
        firebase.initializeApp(firebaseConfig);

        // Obtenha uma referência para a coleção onde deseja armazenar os dados
        const db = firebase.firestore();
        const dadosCollection = db.collection('controlemensal-sacolinhas');

        // Função para calcular campos dependentes
        function calcularCamposDependentes() {
            // Lógica para calcular
